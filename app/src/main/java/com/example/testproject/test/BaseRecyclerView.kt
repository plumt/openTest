package com.example.testproject.test

import android.util.Log
import android.view.LayoutInflater
import android.view.ViewGroup
import androidx.annotation.LayoutRes
import androidx.databinding.BindingAdapter
import androidx.databinding.DataBindingUtil
import androidx.databinding.ViewDataBinding
import androidx.recyclerview.widget.RecyclerView
import java.lang.Exception

class BaseRecyclerView {
    interface OnItemClickListener<T>{
        fun onItemClick(item : T)
    }

    abstract class Adapter<ITEM : Any, B : ViewDataBinding>(
        @LayoutRes private val layoutResId: Int,
        private val bindingVariableId: Int? = null
    ) : RecyclerView.Adapter<ViewHolder<ITEM, B>>(), OnItemClickListener<ITEM> {

        private val items = mutableListOf<ITEM>()

        fun replaceAll(items: List<ITEM>?){
            items?.let{
                this.items.run{
                    clear()
                    addAll(it)
                }
            }
        }

        override fun onCreateViewHolder(parent: ViewGroup, viewType: Int) = object : ViewHolder<ITEM, B>(
            layoutResId = layoutResId,
            parent = parent,
            bindingVarableId = bindingVariableId,
            listener = this
        ){

        }

        override fun getItemCount() = items.size

        override fun onBindViewHolder(holder: ViewHolder<ITEM, B>, position: Int){
            holder.onBindViewHolder(items[position])
        }
    }

    abstract class ViewHolder<ITEM : Any, B : ViewDataBinding>(
        @LayoutRes layoutResId: Int,
        parent: ViewGroup,
        private val bindingVarableId: Int?,
        val listener: OnItemClickListener<ITEM>
    ) : RecyclerView.ViewHolder(
        LayoutInflater.from(parent.context).inflate(layoutResId, parent, false)
    ){
        protected val binding: B = DataBindingUtil.bind(itemView)!!

        fun onBindViewHolder(item: ITEM?){
            try{
                bindingVarableId?.let{
                    binding.setVariable(it,item)
                }
                itemView.setOnClickListener{
                    item?.run{
                        listener.onItemClick(this)
                    }
                }
            } catch (e: Exception){
                e.printStackTrace()
            }
        }
    }
}

@BindingAdapter("replaceAll")
fun RecyclerView.replaceAll(list: List<Any>?){
    Log.i("sjh", "1111111111111111111")
    (this.adapter as? BaseRecyclerView.Adapter<Any, *>)?.run{
        Log.i("sjh", "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa")
        replaceAll(list)
        notifyDataSetChanged()
    }
}