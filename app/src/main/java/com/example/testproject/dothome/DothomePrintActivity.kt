package com.example.testproject.dothome

import androidx.appcompat.app.AppCompatActivity
import android.os.Bundle
import android.util.Log
import androidx.databinding.DataBindingUtil
import com.example.testproject.R
import com.example.testproject.retrofit.RetrofitService
import com.example.testproject.databinding.ActivityDothomePrintBinding
import com.example.testproject.retrofit.board
import com.example.testproject.retrofit.person
import com.google.gson.Gson
import com.google.gson.GsonBuilder
import retrofit2.Call
import retrofit2.Callback
import retrofit2.Response
import retrofit2.Retrofit
import retrofit2.converter.gson.GsonConverterFactory

class DothomePrintActivity : AppCompatActivity() {

    val tag: String = "lys"
    private lateinit var binding: ActivityDothomePrintBinding
    var txt = ""
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        binding = DataBindingUtil.setContentView(this,R.layout.activity_dothome_print)
        binding.activity = this

        var gson: Gson = GsonBuilder()
            .setLenient()
            .create()

        val builder: Retrofit.Builder = Retrofit.Builder()
            .baseUrl("http://plumt.dothome.co.kr/")
            .addConverterFactory(GsonConverterFactory.create(gson))

        val retrofit: Retrofit = builder.build()

        val client: RetrofitService = retrofit.create(RetrofitService::class.java)

        val call: Call<List<board>> = client.getForuser()

        call.enqueue(object : Callback<List<board>> {
            override fun onFailure(call: Call<List<board>>, t: Throwable) {
                Log.e(tag, "${t.message}")
                Log.e(tag, call.toString())
            }

            override fun onResponse(call: Call<List<board>>, response: Response<List<board>>) {
                val repos: List<board>? = response.body()
                var str: String = ""
                repos?.forEach { it ->
                    str += it.id + "\n" + it.name + "\n" + it.memo + "\n" +
                            it.title + "\n" + it.date + "\n" + it.num + "\n\n"
                }
                txt = str
                binding.invalidateAll()
            }
        })


    }
}